<!--
  This file was generated by emdaer

  Its template can be found at .emdaer/README.emdaer.md
-->

<!--
  emdaerHash:e298bf6d3ea944d6b83fce3d01b08790
-->

<p align="center"><img src="https://raw.githubusercontent.com/okaysoftware/iom/master/images/iom.svg?sanitize=true" alt="iom"></p>

<p align="center">
  <a href="https://travis-ci.org/okaysoftware/iom/"><img src="https://img.shields.io/travis/okaysoftware/iom.svg?style=flat-square" alt="Travis"></a> <a href="https://bundlephobia.com/result?p=iom"><img src="https://img.shields.io/bundlephobia/minzip/iom.svg?style=flat-square" alt="bundlephobia"></a> <a href="http://npmjs.com/package/iom"><img src="https://img.shields.io/node/v/iom.svg?style=flat-square" alt="Node"></a> <a href="http://npmjs.com/package/iom"><img src="https://img.shields.io/npm/v/iom.svg?style=flat-square" alt="NPM"></a>
</p>

<!-- toc -->
<ul>
<li><a href="#what">What</a></li>
<li><a href="#why">Why</a></li>
<li><a href="#how">How</a><ul>
<li><a href="#a-quick-example">A Quick Example</a><ul>
<li><a href="#1-lets-create-a-new-store">1. Letâ€™s create a new storeâ€¦</a></li>
<li><a href="#2-and-subscribe-to-the-store">2. And subscribe to the storeâ€¦</a></li>
<li><a href="#3-and-update-the-state">3. And update the stateâ€¦</a></li>
<li><a href="#4-and-clean-up">4. And clean up</a></li>
<li><a href="#5-then-read-the-docshttpsokaysoftwaregithubioiom">5. <a href="https://okaysoftware.github.io/iom/">Then read the docs!</a></a></li>
</ul>
</li>
<li><a href="#usage-with-react">Usage with React</a></li>
<li><a href="#purity-and-stack-safety">Purity and Stack Safety</a><ul>
<li><a href="#purity">Purity</a></li>
<li><a href="#stack-safety">Stack Safety</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h2 id="what">What</h2>
<blockquote>
<p>iom is Esperanto for â€œa littleâ€ ğŸ˜‰</p>
</blockquote>
<p>Tiny, simple, over-powered state management</p>
<h2 id="why">Why</h2>
<p>Itâ€™s a good question â€” why did I need to roll my own state management library?</p>
<p>First of all, I didnâ€™t need to and other options may very well better suit your needs</p>
<p>But, since you asked:</p>
<ul>
<li>ğŸ£ itâ€™s tiny (~Â¼kB last time I checked) </li>
<li>ğŸ”¤ itâ€™s simple (one class whose instances surface only two methods)</li>
<li>ğŸš€ itâ€™s op af (caveat being that thereâ€™s no hand-holding whatsoever)</li>
</ul>
<h2 id="how">How</h2>
<h3 id="a-quick-example">A Quick Example</h3>
<p>If youâ€™re wondering how state management can be over-poweredâ€¦</p>
<p align="center"><img src="https://raw.githubusercontent.com/okaysoftware/iom/master/images/how.png?sanitize=true" alt="A Quick Example"></p>

<h4 id="1-let-s-create-a-new-store-">1. Letâ€™s create a new storeâ€¦</h4>
<p>Import iom</p>

```js
import Store from 'iom';
```
<p>Describe the initial stateâ€¦ may as well save it somewhere, right?</p>

```js
const INITIAL_STATE = { on: false };
```
<p>Create the store by passing the initial state into the constructor</p>

```js
const store = new Store(INITIAL_STATE);
```
<p>Now you have a store</p>
<h4 id="2-and-subscribe-to-the-store-">2. And subscribe to the storeâ€¦</h4>
<p>Weâ€™ll just send state updates to the console for now</p>

```js
const subscriber = console.log;
```
<p>Passing a subscriber to the store returns a function which cancels the subscriptionâ€¦ letâ€™s hang onto that</p>

```js
const cancel = store.subscribe(subscriber);
// => { on: false }
```
<p>All subscribers receive the current state when added to the store</p>
<h4 id="3-and-update-the-state-">3. And update the stateâ€¦</h4>
<p>This is where iom likely diverges from state managers youâ€™ve used before</p>
<p>You may notice that we havenâ€™t talked at all about updating state yet</p>
<p>Thatâ€™s because you can update state in anyway that you like at any point because actions are simply functions passed to the store which take the current state as their argument and return the new state</p>
<p>So letâ€™s create an action</p>

```js
const toggleOn = state => ({ ...state, on: !state.on });
```
<p>And perform an update</p>

```js
store.update(toggleOn);
// => { on: true }
```
<p>And thatâ€™s iom!</p>
<h4 id="4-and-clean-up">4. And clean up</h4>
<p>You can add and remove subscribers at any point</p>
<p>So letâ€™s cancel our subscription now that weâ€™re done</p>

```js
cancel();
```
<h4 id="5-then-read-the-docs-">5. <a href="https://okaysoftware.github.io/iom/">Then read the docs!</a></h4>
<h3 id="usage-with-react">Usage with React</h3>
<p align="center"><img src="https://raw.githubusercontent.com/okaysoftware/iom/master/images/react-store.png?sanitize=true" alt="React contexts/store.js"></p>


```js
// src/contexts/store.js

import Store from "iom";
import { createContext } from "react";

export const INITIAL_STATE = { on: false };
export const store = new Store(INITIAL_STATE);

export const { Provider, Consumer } = createContext(INITIAL_STATE);
```
<p align="center"><img src="https://raw.githubusercontent.com/okaysoftware/iom/master/images/react-app.png?sanitize=true" alt="React App.js"></p>


```js
// src/App.js

import React, { Component } from "react";

import { store, INITIAL_STATE, Provider } from "./contexts/store";
import Switch from "./components/Switch.js";

class App extends Component {
  constructor() {
    super();
    this.state = INITIAL_STATE;
  }
  componentDidMount() {
    store.subscribe(state => this.setState(state));
  }
  render() {
    return (
      <Provider value={this.state}>
        <Switch />
      </Provider>
    );
  }
}

export default App;
```
<p align="center"><img src="https://raw.githubusercontent.com/okaysoftware/iom/master/images/react-switch.png?sanitize=true" alt="React components/Switch.js"></p>


```js
// src/components/Switch.js

import React, { Component, Fragment } from "react";

import { store, Consumer } from "../contexts/store";

class Switch extends Component {
  toggleOn() {
    store.update(state => ({ ...state, on: !state.on }));
  }
  render() {
    return (
      <Fragment>
        <Consumer>{({ on }) => (on ? "ğŸ™‚" : "ğŸ™ƒ")}</Consumer>
        <button onClick={this.toggleOn}>Toggle</button>
      </Fragment>
    );
  }
}

export default Switch;
```
<h3 id="purity-and-stack-safety">Purity and Stack Safety</h3>
<p>Purity and stack safety are up to you </p>
<h4 id="purity">Purity</h4>
<p>If youâ€™re using a mutable data structure for your state, be mindful and donâ€™t mutate it</p>
<h4 id="stack-safety">Stack Safety</h4>
<p>Donâ€™t call actions from within subscribers or other actions or you are very likely to encounter infinite loops</p>
<hr>
<p>iom is <a href="./LICENSE">MIT licensed</a>.</p>
